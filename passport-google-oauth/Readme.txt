this code is taken from the original facebook auth code, then re-do some stuff